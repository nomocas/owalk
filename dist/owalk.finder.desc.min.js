!function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{var g;g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,g.owalk=f()}}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){require("../lib/descriptor"),module.exports=require("../lib/finder")},{"../lib/descriptor":3,"../lib/finder":4}],2:[function(require,module,exports){module.exports={print:function(node){node?node.__owalk_node__||node.__owalk_array__?node.forEach?node.forEach(function(n){n&&console.log("> node : %s : ",n.path,n.value)}):console.log("node : %s : ",node.path,node.value):console.log("pure property : ",node):console.log("node is null")}}},{}],3:[function(require,module,exports){var owalk=require("../index"),Descriptor=function(parent,key){var path;if(parent){if(this.parent=parent,path=parent.path,path+=parent.key?"/"+key:key,parent.schema){if(!owalk.getSchemaByPath)throw new Error("no method 'getSchemaByPath' founded in owalk. could not use schema in it.");this.schema=owalk.getSchemaByPath(parent.schema,key,"/")}this.value=parent.value[key],this.depth=parent.depth+1,this.root=parent.root||parent}this.__owalk_node__=!0,this.path=path,this.key=key};Descriptor.prototype={set:function(value){return this.value=value,this.parent&&(this.parent.value[this.key]=value),value},clone:function(){return this.parent?new Descriptor(this.parent,this.key):Descriptor.root(this.value,this.schema)}},Descriptor.root=function(obj,schema){obj&&obj._deep_undefined_&&(obj=void 0);var node=new Descriptor;return node.value=obj,node.path="/",node.schema=schema,node.depth=0,node},owalk.Descriptor=Descriptor,module.exports=owalk},{"../index":2}],4:[function(require,module,exports){function parseStep(selector){switch(selector[0]){case"?":return{value:selector,type:"rql"};case"(":return{value:new RegExp(selector),type:"regex"};case".":return{value:selector,type:"move"};case"[":return{value:selector.substring(1,selector.length-1).split(",").map(parseStep),type:"union"};default:return{value:selector,type:"sel"}}}function parse(q){if(queryCache[q])return queryCache[q];for(var match=null,tokens=[];match=step.exec(q);)"//"===match[1]&&tokens.push({type:"recursion"}),tokens.push(parseStep(match[3]?match[3]:match[2]));return queryCache[q]=tokens,tokens}function select(obj,key,desc){if(obj.forEach){for(var output=[],i=0,len=obj.length;len>i;++i){var o=obj[i],v=desc?o.value:o;v[key]&&output.push(desc?new owalk.Descriptor(obj[i],key):v[key])}return output}var v=desc?obj.value:obj;return v[key]?desc?new owalk.Descriptor(obj,key):v[key]:void 0}function selectRegExp(obj,regex,desc){var i,j,o,output=[],v=desc?obj.value:obj;if(obj.forEach)for(i=0,len=obj.length;i<len;++i){o=obj[i],v=desc?o.value:o;for(j in v)regex.test(j)&&output.push(desc?new owalk.Descriptor(o,j):v[j])}else for(j in v)regex.test(j)&&output.push(desc?new owalk.Descriptor(obj,j):v[j]);return output}function selectRQL(obj,rqlQuery,desc){if(!owalk.rql)throw new Error("no rql-array module has been linked to owalk : you could not use rql in your query");if(obj.forEach)return owalk.rql(obj,rqlQuery);var res=owalk.rql([obj],rqlQuery);return res?res[0]:void 0}function selectChildren(obj,recursive,desc){var i,j,o,output=[],v=desc?obj.value:obj;if(obj.forEach){for(i=0,len=obj.length;i<len;++i)if(o=obj[i],v=desc?o.value:o,"object"==typeof v)for(j in v){var child=desc?new owalk.Descriptor(o,j):v[j],cv=desc?child.value:child;output.push(child),recursive&&cv&&"object"==typeof cv&&(output=output.concat(selectChildren(child,!0,desc)))}}else if("object"==typeof v)for(j in v){var child=desc?new owalk.Descriptor(obj,j):v[j],cv=desc?child.value:child;output.push(child),recursive&&cv&&"object"==typeof cv&&(output=output.concat(selectChildren(child,!0,desc)))}return output}function selectParent(obj,desc){if(desc){var cacheCheck={};if(obj.forEach){var i,output=[];for(i=0,len=obj.length;i<len;++i){var o=obj[i];cacheCheck[o.parent.path]||(output.push(o.parent),cacheCheck[o.parent.path]=!0)}return output}return obj.parent}}function applyStep(obj,step,desc){switch(step.type){case"rql":return selectRQL(obj,step.value,desc);case"move":switch(step.value){case".":return obj;case"..":return selectParent(obj,desc);default:throw new Error("dpath : bad move parsing")}break;case"recursion":return selectChildren(obj,!0,desc);case"sel":switch(step.value){case"":return obj;case"*":return selectChildren(obj,!1,desc);default:return select(obj,step.value,desc)}break;case"union":for(var output,res=[],i=0,len=step.value.length;len>i;++i)output=applyStep(obj,step.value[i],desc),"undefined"!=typeof output&&(res=res.concat(output));return res;case"regex":return selectRegExp(obj,step.value,desc);default:throw new Error("desc.find : step type unrecognised : "+step.type)}}function find(q,obj,desc){if(obj){if(desc&&!owalk.Descriptor)throw new Error("owalk descriptor module has not been loaded. You could not ask owalk Descriptor response.");var tokens=parse(q),tmp=desc?obj.__owalk_node__?obj:owalk.Descriptor.root(obj):obj;desc&&tokens[0]&&"move"==!tokens[0].type&&(obj=obj.root||obj);for(var i=0,len=tokens.length;tmp&&len>i;++i)if(tmp=applyStep(tmp,tokens[i],desc),tmp&&tmp.forEach&&!tmp.length)return;return desc&&tmp&&tmp.forEach&&(tmp.__owalk_array__=!0),tmp}}var owalk=require("../index"),step=/(?:(\/\/?)([^\/]*))|(\.\.?)/g,queryCache={};owalk.find=find,owalk.parseQuery=parse,module.exports=owalk},{"../index":2}]},{},[1])(1)});